package Ability;

import java.awt.geom.Point2D;

import Entity.Entity;
import Movement.Force;
import Movement.MovementComponent;

public class ProjectileAbility extends PointAbility
{
	private Entity projectile;

	private double offset;

	private Force force;	
	
	private Sector sector;
	
	public ProjectileAbility()
	{
		projectile = new Entity();
		
		force = new Force();
		
		offset = 5;
		
		sector = new Sector();
	}
	
	public void activate()
	{
		super.activate();	
		
		Point2D.Double src = getSrc().getLoc();
		
		double angle = Math.atan2(target.y - src.y, 
								  target.x - src.x);
		
		int pivots = sector.getPivots();
		
		double sectorAngle = sector.getAngle(),
			   pivotAngle = sector.getAngle() / pivots,
			   newAngle = angle - sectorAngle/2;
		
		for(int i = 0; i < pivots; i++, newAngle += pivotAngle)
		{
			double x = src.x + Math.cos(newAngle) * offset,
				   y = src.y + Math.sin(newAngle) * offset;
			
			Force force = (Force) this.force.clone();
			
			force.setDirection(newAngle);
			
			Entity clone = (Entity) projectile.clone();
			
			clone.setLoc(x, y);
			
			if(clone.contains(MovementComponent.class))
				clone.get(MovementComponent.class)
					 .getMovement()
					 .addForce(force);
			
			this.src.getSceneLoc()
					.addEntity(clone);
		}
	}
	
	public Force getForce() {
		return force;
	}
	
	public Entity getProjectile() {
		return projectile;
	}
}
