package GUI;

import java.awt.Canvas;

import Actions.ActionBuffer;
import Entity.Entity;
import Game.Scene;
import Game.Updater;
import Graphic.Camera;
import Graphic.Painter;

public class UI
{
	public final int CANVAS_MODE = 0, FRAME_MODE = -1;
	
	private UIController controller;
	
	private GFrame frame;
	private Canvas canvas;
	
	private Painter painter;
	
	private Camera camera;
	
	private ActionBuffer buffer;
	
	private HUD hud;
	
	public UI(Scene scene, Updater updater, Entity player,
			  int viewMode)
	{		
		controller = new UIController(this);
		
		GLayeredPane layers = new GLayeredPane();
		
		hud = new HUD();
		
		camera = new Camera();
		
		if(viewMode == CANVAS_MODE)
		{
			frame = new GFrame(updater);
			painter = new Painter(frame, camera);
		}
		else
		{
			canvas = new Canvas();
			painter = new Painter(canvas, camera);
		}
		
		buffer = new ActionBuffer();
		
		painter.addPaintable(scene);
		
		updater.addUpdatable(d -> painter.paint(),
							 d -> buffer.invokeAll());
		
		camera.setFocus(player.getLoc());
		
		MouseController mouseControl = new MouseController(
				player, camera, buffer);
		
		frame.addMouseListener(mouseControl);
		
		frame.getRootPane()
			 .setOpaque(false);
	
		frame.setContentPane(layers);
		
		layers.addAndSetLayer(hud, 1);
	}
	
	public void setGUIVisible(boolean visible) 
	{
		frame.setVisible(visible);
	}
	
	public HUD getHUD() {
		return hud;
	}
}
