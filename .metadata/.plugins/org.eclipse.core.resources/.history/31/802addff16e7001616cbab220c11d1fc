package Graphic;

import java.awt.Canvas;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.RenderingHints;
import java.awt.Window;
import java.awt.geom.AffineTransform;
import java.awt.image.BufferStrategy;
import java.util.Collection;
import java.util.LinkedList;
import java.util.Map;

public class Painter
{
	private Collection<Paintable> paintables;
			
	private Map<?, ?> renderingHintMap;
	
	private Camera camera;
	
	private Window window;
	
	private Canvas canvas;
	
	public Painter(Window window, Camera camera,
				   Dimension canvasSize)
	{
		this.window = window;
		this.camera = camera;
				
		paintables = new LinkedList<Paintable>();
	}
	
	public Painter(Canvas canvas, Camera camera,
				   Dimension canvasSize)
	{
		this.canvas = canvas;
		this.camera = camera;
				
		paintables = new LinkedList<Paintable>();
	}
	
	public void paint()
	{
		BufferStrategy strategy;
		Dimension size;
		
		if(window == null)
		{
			strategy = canvas.getBufferStrategy();
			size = canvas.getSize();
		}
		else
		{
			strategy = window.getBufferStrategy();
			size = window.getSize();
		}
		
		if(strategy == null) return;
		
		do {
			
			do {	
				Graphics g = strategy.getDrawGraphics();
				
				g.setColor(Color.white);
				g.fillRect(0, 0, size.width, size.height);
				
				GraphicsContext gc = new GraphicsContext(g, camera);
			
				camera.setScreenDimension(size.width, size.height);
				camera.transformGraphics(gc.g2d);
				
				for(Paintable p : paintables)
					p.paint(gc);	
				
				if(window != null)
					window.paintComponents(g);	
				
				g.dispose();
				gc.g2d.dispose();
				
			} while(strategy.contentsRestored());
			
			strategy.show();
			
		} while(strategy.contentsLost());
	}
	
	public void setCanvasSize(Dimension canvasSize) {
		this.canvasSize = canvasSize;
		
	}
	
	public Camera getCamera() {
		return camera;
	}
	
	public void addPaintable(Paintable p) {
		paintables.add(p);
	}
	
	public void removePaintable(Paintable p) {
		paintables.remove(p);
	}
}
