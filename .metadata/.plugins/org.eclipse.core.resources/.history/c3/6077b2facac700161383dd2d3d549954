package Editor.layer_selector;

import javax.swing.undo.CannotRedoException;
import javax.swing.undo.CannotUndoException;
import javax.swing.undo.UndoableEdit;

import Editor.EditorResources;
import Tileset.Tile;
import Tileset.TileMap;

public class SetTile implements UndoableEdit
{	
	private EditorResources resources;
	
	private TileMap tm;
	
	private Tile tile, prevTile;
	
	private int row, col;
	
	private boolean replaced;
	
	public SetTile(EditorResources resources,
			TileMap tm, Tile tile, int row, int col)
	{
		this.resources = resources;
		this.tm = tm;
		this.tile = tile;
		this.row = row;
		this.col = col;
		
		replaced = false;
	}
	
	public Tile getTile() {
		return tile;
	}
	
	public int getRow() {
		return row;
	}
	
	public int getCol() {
		return col;
	}
	
	
	@Override // not used
	public boolean addEdit(UndoableEdit e) {
		return false;
	}

	@Override
	public boolean canRedo() {
		return !replaced;
	}

	@Override
	public boolean canUndo() {
		return !replaced;
	}

	@Override // not used
	public void die() {}

	@Override // not used
	public String getPresentationName() {
		return "";
	}

	@Override // not used
	public String getRedoPresentationName() {
		return "";
	}

	@Override // not used
	public String getUndoPresentationName() {
		return "";
	}

	@Override
	public boolean isSignificant() {
		return true;
	}

	public void invoke()
	{
		prevTile = tm.get(row, col);
		tm.set(row, col, tile);
		resources.notifyOfSceneChange();
	}
	
	@Override
	public void redo() throws CannotRedoException 
	{
		if(replaced)
			throw new CannotUndoException();
		
		invoke();
	}

	@Override 
	public boolean replaceEdit(UndoableEdit edit) 
	{
		if(replaced || edit == this) 
			return false;
		
		if(edit instanceof UndoableEdit)
		{
			SetTile stEdit = (SetTile)edit;

			System.out.println(stEdit.getTile().equals(tile) &&
					   stEdit.getRow() == row &&
					   stEdit.getCol() == col
			);

			replaced = stEdit.getTile().equals(tile) &&
					   stEdit.getRow() == row &&
					   stEdit.getCol() == col;
						
			return replaced;
		}
		
		return false;
	}

	@Override
	public void undo() throws CannotUndoException 
	{
		if(replaced)
			throw new CannotUndoException();
		
		tm.set(row, col, prevTile);
		resources.notifyOfSceneChange();
	}
}