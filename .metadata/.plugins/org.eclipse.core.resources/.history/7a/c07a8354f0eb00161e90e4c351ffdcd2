package Game;

import Actions.ActionComponent;
import Entity.Entity;
import EntityComponent.GraphicsComponent;
import GUI.UI;
import Inventory.InventoryComponent;
import Item.EquipItem;
import Movement.MovementComponent;
import Quest.GatherTask;
import Quest.Quest;
import Quest.QuestComponent;
import Utilities.Scheduler;

public class Game
{
	private Scene scene;

	private Entity player;
	
	private UI ui;
	
	private Updater updater;
	private Scheduler scheduler;
		
	public Game()
	{	
		scene = new Scene();
		
		updater = new Updater(60);

		scheduler = new Scheduler();
		
		updater.addUpdatable(
				delta -> scene.update(delta),
				delta -> scheduler.update(delta));
		
		player = new Entity();
		
		ui = new UI(scene, updater, player);
		
		// TESTING
		
		player.add(new GraphicsComponent(),
				   new MovementComponent(),
				   new ActionComponent(),
				   new InventoryComponent(),
				   new QuestComponent());
		
		scene.addEntityNow(player);
		
		Quest quest = new Quest();

		GatherTask task = new GatherTask();
		
		quest.addTask(task);
		
		player.get(QuestComponent.class)
			  .addQuest(quest);
		

		for(int i = 0; i < 2500; i += 500)
		{
			scheduler.schedule(
					()-> player.get(InventoryComponent.class)
							   .getInventory()
							   .addEquipItem(new EquipItem()), i);
		}
		
		Entity npc = new Entity();
		
		npc.add(new GraphicsComponent());
		
		npc.setLoc(0, -50);
		
		scene.addEntity(npc);
	}
	
	public void start()
	{
		ui.setGUIVisible(true);
		updater.start();
	}
}
