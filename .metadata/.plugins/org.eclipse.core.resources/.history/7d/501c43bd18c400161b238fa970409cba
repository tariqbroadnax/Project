package Editor.comp;

import java.awt.BasicStroke;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Rectangle;
import java.awt.event.MouseEvent;
import java.awt.geom.Rectangle2D;

import javax.swing.JComponent;
import javax.swing.SwingUtilities;

import Editor.EditorResources;
import Editor.SceneListener;
import EditorGUI.MouseListener;
import Graphic.Camera;
import Tileset.TileMap;

public class TileMapComp extends JComponent
	implements SceneListener, MouseListener
{
	private EditorResources resources;
	private TileMap tm;
	private Camera camera;
	
	public TileMapComp(
			EditorResources resources,
			TileMap tm, Camera camera)
	{
		this.resources = resources;
		this.tm = tm;
		this.camera = camera;
		
		updateLocAndSize();
		resources.addSceneListener(this);
		addMouseListener(this);
	}
	
	private void updateLocAndSize()
	{
		Rectangle2D.Double bound = tm.getBound();
		Rectangle scrBound = camera.onScreenBound2(bound);
		
		setLocation(scrBound.x, scrBound.y);
		setSize(scrBound.width, scrBound.height);
	}
	
	public void paintComponent(Graphics g)
	{
		super.paintComponent(g);
		
		if(resources.selection == tm)
		{
			Graphics2D g2d = (Graphics2D)g.create();
			
			paintSelectionIndicator(g2d);
			
			g2d.dispose();
		}
	}
	
	private void paintSelectionIndicator(Graphics2D g2d)
	{
		float width = 2,
			  miterLimit = 1,
			  dashOffset = 0;
		
		int cap = BasicStroke.CAP_SQUARE,
			join = BasicStroke.JOIN_MITER;
		
		float[] dash = {5f};
		
		BasicStroke stroke = new BasicStroke(
				width, cap, join, miterLimit, dash, dashOffset);
	
		g2d.setColor(Color.black);
		g2d.setStroke(stroke);
		
		Dimension size = getSize();
		
		g2d.drawRect(0, 0, size.width, size.height);
	}

	@Override
	public void sceneChanged() 
	{
		updateLocAndSize();
	}
	
	@Override
	public void mousePressed(MouseEvent e) 
	{
		if(SwingUtilities.isLeftMouseButton(e))
		{
			if(resources.selection == null ||
			   resources.sceneSelection)
			{
				resources.selection = tm;
				resources.sceneSelection = true;
				repaint();
			}
		}		
	}
}
