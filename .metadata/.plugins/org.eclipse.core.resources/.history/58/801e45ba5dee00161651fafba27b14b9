package Game;

import java.awt.geom.Point2D;

import Ability.PointAbility;
import Actions.ActionComponent;
import Entity.Entity;
import EntityComponent.AbilityComponent;
import EntityComponent.GraphicsComponent;
import Event.SpawnProjectile;
import GUI.UI;
import Inventory.InventoryComponent;
import Movement.MovementComponent;
import Quest.QuestComponent;
import Utilities.Scheduler;

public class Game
{
	private Scene scene;

	private Entity player;
	
	private UI ui;
	
	private Updater updater;
	private Scheduler scheduler;
	private AudioPlayer audioPlayer;
		
	public Game()
	{	
		scene = new Scene();
		
		updater = new Updater(60);

		scheduler = new Scheduler();
		
		updater.addUpdatable(
				delta -> scene.update(delta),
				delta -> scheduler.update(delta));
		
		player = new Entity();
		
		ui = new UI(scene, updater, player);
		
		audioPlayer = new AudioPlayer();
		// TESTING
		
		player.add(new GraphicsComponent(),
				   new MovementComponent(),
				   new AbilityComponent(),
				   new ActionComponent(),
				   new InventoryComponent(),
				   new QuestComponent());
		
		SpawnProjectile event = new SpawnProjectile(this);
		
		PointAbility ability = new PointAbility();
		
		ability.addPointAbilityEvent(event);
		
		AbilityComponent comp = player.get(AbilityComponent.class);

		comp.addPointAbility(ability);

		for(int i = 0; i < 5; i++)
		{
			scheduler.schedule(() -> comp.castPointAbility(0, new Point2D.Double(-50,-50)), i * 500);
		}
		
		scene.addEntityNow(player);
	
		Entity npc = new Entity();
		
		npc.add(new GraphicsComponent());
		
		npc.setLoc(0, -50);
		
		scene.addEntity(npc);
//		
//		try {
//			File file = new File("C:\\Users\\Tariq Broadnax\\Downloads\\Deep.wav");
//			System.out.println(file.exists());
//			Clip clip = AudioSystem.getClip();
//			
//			for(javax.sound.sampled.AudioFileFormat.Type type : AudioSystem.getAudioFileTypes())	
//				System.out.println(type.getExtension());
//			
//			clip.open(AudioSystem.getAudioInputStream(file));
//			
//			audioPlayer.start(clip);
//		} catch (Exception e) {
//			// TODO Auto-generated catch block
//			e.printStackTrace();
//		}
//		
	}
	
	public void start()
	{
		ui.setGUIVisible(true);
		updater.start();
	}
	
	public Scene getScene() {
		return scene;
	}
	
	public Entity getPlayer() {
		return player;
	}
	
	public UI getUI() {
		return ui;
	}
}
